<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../../../../partials/head %>
    <title></title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
</head>
<script type="text/javascript" src="/js/jquery-1.10.2.js"></script>
<body>

    <header>
        <% include ../../../../partials/header %>
    </header>


    <div class="container-fluid">
        <div class="row">
            <!-- 2단길이의 첫번째 열 -->
            <div class="col-md-2">
                <% include ../../../../partials/side %>
            </div>

            <!-- 10단길이의 첫번째 열 -->
            <div class="col-md-10">
                <div id="page-inner">
                    <div class="row">
                        <div class="col-md-12">
                            <h1 class="page-header">
                                챌린지 참여인원 관리
                                <!-- <small> 챌린지 관리 Sub제목</small> -->
                            </h1>
                        </div>
                    </div>
                    <%// challenge.forEach(function(post2){ %>
                    <%// if(challenge.reward == false) { %>
                        <!-- <div class="row g-4 align-items-left">
                            <div class="col-2">
                            현재 챌린지 참여 인원
                                <span>
                                    <%// console.log(post2.dailycheck.length) %>
                                    (<%=// post2.dailycheck.length %>)명
                                </span>
                            </div>
                        </div> -->
                        <%// if(challenge) { %>
                        <%// if(challenge.reward == false) { %>
                        <!-- <tr class="noData">
                            <td colspan="5">현재 챌린지 참여 인원
                                <span class="dailycheck">(<%=// challenge.length %>)</span>
                                <span class="dailycheck">(<%=// challenge.reward %>)</span>
                                <%// console.log(challenge) %>
                            </td>
                          </tr> -->
                        <%// } %>
                        <%// } %>
                    <%// } %>
                    <%// }) %>

                        <form class="checkValidation" action="/challengeOngoing/" id="search">
                            <%// if(typeof testSearch.findAfter == "undefined" || testSearch.findAfter == null || testSearch.findAfter == "") {%>
                            
                            <%// } else { %>
                                <div class="row g-4 align-self-center">
                                    <div class="col-2">
                                        <input type="hidden" class="form-check-input" name="termCheck[weeklyy]" 
                                            value="true" id="inlineCheckbox2" <%// if(testSearch.findAfter.weeklyy)  %>/>
                                    </div>
                                </div>
                            <%// } %>
                                <!-- <div class="row justify-content-center">
                                    <div class="col-12">
                                        <button type="submit" id="btnSearch"  class="btn btn-info" <%=// search.searchType=="author!"?"disabled":"" %>>확인</button>
                                    </div>
                                </div> -->
                        </form>

                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-image text-center" id="table-1">
                            <thead>
                                <tr>
                                <th scope="col"></th>
                                <th scope="col">챌린지</th>
                                <th scope="col">아이디</th>
                                <th scope="col">시작 날짜</th>
                                <th scope="col">회차</th>
                                <th scope="col">진행 여부</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if(challenge == null || challenge.length == 0){ %>
                                    <tr class="noData">
                                        <td colspan="5">There is no data to show :(</td>
                                    </tr>
                                <% } %>
                                <% challenge.forEach(function(post, index){ %>
                                    <% if(post.missioncomplete === false && post.reward === false) { %>
                                    <tr>
                                        <th scope="row" class="align-middle">
                                            <div>
                                                <input type="checkbox" onclick="selectCheckRow(this)" name="del_unit[]" value="<%= post._id %>">
                                            </div>
                                        </th>
                                        <%// console.log(post) %>
                                        <td class="align-middle"><u><%= post.title %></u></td>
                                        <td class="align-middle"><u><%= post.email %></u></td>
                                        <% var realTime = post.createdAt %>
                                        <% realTime.setHours(realTime.getHours() - 9); %>
                                        <td class="align-middle"><%= post.getFormattedDate(post.createdAt) %>
                                        </td>
                                        <td class="align-middle"><%= post.dailycheck.length %>일차
                                        <%// console.log(post.dailycheck) %>
                                        </td>
                                        <% var toDay = new Date(); %>
                                        <% var createdDay = post.createdAt %>
                                        <%if(post.dailycheck.length == 0) { %>
                                            <!--시작 날짜가 오늘 날짜보다 크거나(클 수가 없음) 같으면 진행중 else는 실패. 일반적인 데이터끼리는 시간까지 나오기 때문에 값이 같을 수가 없어서 getDate로 해당 일로 비교값 사용-->
                                            <%// if(createdDay.getDate() >= toDay.getDate()) { %>
                                            <!-- 0일차 일 때, 시작날짜 ex)6/30 == 오늘날짜 ex) 6/30 일 때만 진행중이여야 함. -->
                                            <% if(createdDay.getDate() === toDay.getDate()) { %>
                                                <td class="align-middle">
                                                    진행중
                                                </td>
                                            <% } else { %>
                                                <td class="align-middle">
                                                    실패
                                                </td>
                                            <% } %>
                                        <% } else if(post.dailycheck.length > 0) { %>
                                            <!--회차가 0보다 큰 애들은 오늘날짜 - 시작날짜가 회차보다 작거나 같으면 진행중 아니면 실패 -->
                                            <%// console.log(toDay.getDate() - createdDay.getDate()) %>
                                            <% if(toDay.getDate() - createdDay.getDate() <= post.dailycheck.length ) { %>
                                                <td class="align-middle">
                                                    진행중
                                                </td>
                                            <% } else { %>
                                                <td class="align-middle">
                                                    실패
                                                </td>
                                            <% } %>
                                        <% } %>
                                    </tr>
                                    <% } %>
                                <% }) %>
                            </tbody>
                        </table>





                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
<script src="/js/custom-scripts.js"></script>
<script src="/js/jquery-1.10.2.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tablednd.0.7.min.js"></script>
<script>

function useYChange(chk) {
        var chk = document.getElementsByName("del_unit[]"); // 체크박스객체를 담는다
        var len = chk.length;    //체크박스의 전체 개수
        var checkRow = '';      //체크된 체크박스의 value를 담기위한 변수
        var checkCnt = 0;        //체크된 체크박스의 개수
        var checkLast = '';      //체크된 체크박스 중 마지막 체크박스의 인덱스를 담기위한 변수
        var rowid = '';             //체크된 체크박스의 모든 value 값을 담는다
        var cnt = 0;

        for (var i = 0; i < len; i++) {
            if (chk[i].checked == true) {
                checkCnt++;        //체크된 체크박스의 개수
                checkLast = i;     //체크된 체크박스의 인덱스
            }
        }
        for (var i = 0; i < len; i++) {
            if (chk[i].checked == true) {  //체크가 되어있는 값 구분
                checkRow = chk[i].value;
                if (checkCnt == 1) {                            //체크된 체크박스의 개수가 한 개 일때,
                    rowid += "" + checkRow + "";        //'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
                } else {                                            //체크된 체크박스의 개수가 여러 개 일때,
                    if (i == checkLast) {                     //체크된 체크박스 중 마지막 체크박스일 때,
                        rowid += "" + checkRow + "";  //'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
                    } else {
                        rowid += "" + checkRow + ",";	 //'value',의 형태 (뒤에 ,(콤마)가 붙게)
                    }
                }
                cnt++;
                checkRow = '';    //checkRow초기화.
            }
            // alert(rowid);    //'value1', 'value2', 'value3' 의 형태로 출력된다.
        }

        if (confirm('적용 하시겠습니까?')) {
            // alert(rowid);
            var useYFormSubmit = document.useYFormSubmit;
            useYFormSubmit.method = "post";
            useYFormSubmit.target = "_self";
            useYFormSubmit.action = "/contents/Challenge/UseYUpdate/" + rowid + "?_method=post";
            useYFormSubmit.submit();
        }
    }

    function useNChange(chk) {
        var chk = document.getElementsByName("del_unit[]"); // 체크박스객체를 담는다
        var len = chk.length;    //체크박스의 전체 개수
        var checkRow = '';      //체크된 체크박스의 value를 담기위한 변수
        var checkCnt = 0;        //체크된 체크박스의 개수
        var checkLast = '';      //체크된 체크박스 중 마지막 체크박스의 인덱스를 담기위한 변수
        var rowid = '';             //체크된 체크박스의 모든 value 값을 담는다
        var cnt = 0;

        for (var i = 0; i < len; i++) {
            if (chk[i].checked == true) {
                checkCnt++;        //체크된 체크박스의 개수
                checkLast = i;     //체크된 체크박스의 인덱스
            }
        }
        for (var i = 0; i < len; i++) {
            if (chk[i].checked == true) {  //체크가 되어있는 값 구분
                checkRow = chk[i].value;
                if (checkCnt == 1) {                            //체크된 체크박스의 개수가 한 개 일때,
                    rowid += "" + checkRow + "";        //'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
                } else {                                            //체크된 체크박스의 개수가 여러 개 일때,
                    if (i == checkLast) {                     //체크된 체크박스 중 마지막 체크박스일 때,
                        rowid += "" + checkRow + "";  //'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
                    } else {
                        rowid += "" + checkRow + ",";	 //'value',의 형태 (뒤에 ,(콤마)가 붙게)
                    }
                }
                cnt++;
                checkRow = '';    //checkRow초기화.
            }
            // alert(rowid);    //'value1', 'value2', 'value3' 의 형태로 출력된다.
        }

        if (confirm('적용 하시겠습니까?')) {
            // alert(rowid);
            var useNFormSubmit = document.useNFormSubmit;
            useNFormSubmit.method = "post";
            useNFormSubmit.target = "_self";
            useNFormSubmit.action = "/contents/Challenge/UseNUpdate/" + rowid + "?_method=post";
            useNFormSubmit.submit();
        }
    }


    function seqChange(seq) {
        // var chk = document.getElementsByName("quant["+seq+"]")[0].value; // 체크박스객체를 담는다
        var chk = document.getElementsByName("seqNumberId["+seq+"]")[0].value; // 체크박스객체를 담는다
        if(confirm('적용 하시겠습니까?')) {
            var seqFormSubmit = document.getElementsByName("seqFormSubmit"+seq)[0];
            seqFormSubmit.method = "post";
            seqFormSubmit.target = "_self";
            seqFormSubmit.action = "/contents/Challenge/SeqUpdate/" + chk + "?_method=put";
            seqFormSubmit.submit();
        }
    }

    function selectDelRow(chk) {

        var chk = document.getElementsByName("del_unit[]"); // 체크박스객체를 담는다
        var len = chk.length;    //체크박스의 전체 개수
        var checkRow = '';      //체크된 체크박스의 value를 담기위한 변수
        var checkCnt = 0;        //체크된 체크박스의 개수
        var checkLast = '';      //체크된 체크박스 중 마지막 체크박스의 인덱스를 담기위한 변수
        var rowid = '';             //체크된 체크박스의 모든 value 값을 담는다
        var cnt = 0;

        for(var i=0; i<len; i++){
            if(chk[i].checked == true){
            checkCnt++;        //체크된 체크박스의 개수
            checkLast = i;     //체크된 체크박스의 인덱스
            }
        }
        for(var i=0; i<len; i++){
            if(chk[i].checked == true){  //체크가 되어있는 값 구분
                checkRow = chk[i].value;
                if(checkCnt == 1){                            //체크된 체크박스의 개수가 한 개 일때,
                    rowid += ""+checkRow+"";        //'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
                }else{                                            //체크된 체크박스의 개수가 여러 개 일때,
                    if(i == checkLast){                     //체크된 체크박스 중 마지막 체크박스일 때,
                        rowid += ""+checkRow+"";  //'value'의 형태 (뒤에 ,(콤마)가 붙지않게)
                    }else{
                        rowid += ""+checkRow+",";	 //'value',의 형태 (뒤에 ,(콤마)가 붙게)
                    }
                }
                cnt++;
                checkRow = '';    //checkRow초기화.
            }
            // alert(rowid);    //'value1', 'value2', 'value3' 의 형태로 출력된다.
        }



        if(confirm('정말 삭제하시겠습니까?')) {
            // alert(rowid);
            var theForm = document.frmSubmit;
            theForm.method = "post";
            theForm.target = "_self";
            theForm.action = "/contents/Challenge/" + rowid + "?_method=delete";
            theForm.submit();
            $(this).prev().click();
        }
    }

    function selectCheckRow(chk) {
        var obj = document.getElementsByName("del_unit[]");
        for(var i=0; i < obj.length; i++){
            if(obj[i] != chk){
                obj[i].checked = false;
            }
        }



        // alert(rowid);
    }

    $(document).ready(function(){

        // $("#table-1").tableDnD()

        // $("#table-2 tr:even').addClass('alt')");

        // // Initialise the second table specifying a dragClass and an onDrop function that will display an alert
        // $("#table-2").tableDnD({
        //     onDragClass: "myDragClass",
        //     onDrop: function(table, row) {
        //         var rows = table.tBodies[0].rows;
        //         var debugStr = "Row dropped was "+row.id+". New order: ";
        //         for (var i=0; i<rows.length; i++) {
        //             debugStr += rows[i].id+" ";
        //         }
        //         $('#debugArea').html(debugStr);
        //     },
        //     onDragStart: function(table, row) {
        //         $('#debugArea').html("Started dragging row "+row.id);
        //     }
        // });

        // $("currentPage").addClass("active");
        $('li[aria-current="page"]').addClass("active");
        $("#forms-collapse").addClass('show');
        $("a.active").removeClass("active");
        $("#contents").addClass("active");
        $('.btn-number').click(function(e){
            e.preventDefault();

            fieldName = $(this).attr('data-field');
            type      = $(this).attr('data-type');
            var input = $("input[name='"+fieldName+"']");
            var currentVal = parseInt(input.val());
            if (!isNaN(currentVal)) {
                if(type == 'minus') {

                    if(currentVal > input.attr('min')) {
                        input.val(currentVal - 1).change();
                    }
                    if(parseInt(input.val()) == input.attr('min')) {
                        $(this).attr('disabled', true);
                    }

                } else if(type == 'plus') {

                    if(currentVal < input.attr('max')) {
                        input.val(currentVal + 1).change();
                    }
                    if(parseInt(input.val()) == input.attr('max')) {
                        $(this).attr('disabled', true);
                    }

                }
            } else {
                input.val(0);
            }
        });
        $('.input-number').focusin(function(){
        $(this).data('oldValue', $(this).val());
        });
        $('.input-number').change(function() {

            minValue =  parseInt($(this).attr('min'));
            maxValue =  parseInt($(this).attr('max'));
            valueCurrent = parseInt($(this).val());

            name = $(this).attr('name');
            if(valueCurrent >= minValue) {
                $(".btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
            } else {
                alert('Sorry, the minimum value was reached');
                $(this).val($(this).data('oldValue'));
            }
            if(valueCurrent <= maxValue) {
                $(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
            } else {
                alert('Sorry, the maximum value was reached');
                $(this).val($(this).data('oldValue'));
            }


        });
        $(".input-number").keydown(function (e) {
                // Allow: backspace, delete, tab, escape, enter and .
                if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
                    // Allow: Ctrl+A
                    (e.keyCode == 65 && e.ctrlKey === true) ||
                    // Allow: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                        // let it happen, don't do anything
                        return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });

        });
</script>
</html>
